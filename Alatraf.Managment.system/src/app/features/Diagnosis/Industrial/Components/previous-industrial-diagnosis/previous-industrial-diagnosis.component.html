<div class="width-100">
  <p class="title-md">التشخيصات السابقة</p>
  <span class="home-line"></span>
</div>

@if (items.length === 0) {
<p class="body-md padding-16">لا توجد تشخيصات سابقة لهذا المريض.</p>
} @else {

<table>
  <thead>
    <tr>
      <th class="title-sm">رقم الكرت</th>
      <th class="title-sm">تاريخ الاصابة</th>
      <th class="title-sm">التشخيص</th>
      <th class="title-sm">اسباب الاصابة</th>
      <th class="title-sm">جانب الاصابة</th>
      <th class="title-sm">نوع الاصابة</th>
      <th class="title-sm">القطعة الصناعية</th>
      <th class="title-sm">الكمية</th>
      <th class="title-sm">الوحدة</th>
      <th class="buttons"></th>
    </tr>
  </thead>

  <tbody>
    @for (item of items; track item.diagnosisId) { @if
    (!item.diagnosisIndustrialParts || item.diagnosisIndustrialParts.length ===
    0) {
    <tr>
      <td class="body-md">{{ item.repairCardId }}</td>
      <td class="body-md">{{ item.injuryDate | date : "dd-MM-yyyy" }}</td>
      <td class="body-md">{{ item.diagnosisText || "—" }}</td>
      <td class="body-md">{{ formatNames(item.injuryReasons) }}</td>
      <td class="body-md">{{ formatNames(item.injurySides) }}</td>
      <td class="body-md">{{ formatNames(item.injuryTypes) }}</td>
      <td class="body-md">—</td>
      <td class="body-md">—</td>
      <td class="body-md">—</td>
      <td>
        <button class="btn primary icon" type="button" (click)="onView(item)">
          <img src="assets/icons/eye-icon.svg" alt="عرض التفاصيل" />
        </button>
      </td>
    </tr>
    } @else { @for (part of item.diagnosisIndustrialParts ; track
    part.diagnosisIndustrialPartId ?? part.partName; let i = $index) {
    <tr>
      @if (i === 0) {
      <!-- رقم الكرت -->
      <td
        class="body-md"
        [attr.rowspan]="item.diagnosisIndustrialParts.length || 1"
      >
        {{ item.repairCardId }}
      </td>

      <!-- التاريخ -->
      <td
        class="body-md"
        [attr.rowspan]="item.diagnosisIndustrialParts.length || 1"
      >
        {{ item.injuryDate | date : "dd-MM-yyyy" }}
      </td>

      <td
        class="body-md"
        [attr.rowspan]="item.diagnosisIndustrialParts.length || 1"
      >
        {{ item.diagnosisText || "—" }}
      </td>

      <td
        class="body-md"
        [attr.rowspan]="item.diagnosisIndustrialParts.length || 1"
      >
        {{ formatNames(item.injuryReasons) }}
      </td>

      <td
        class="body-md"
        [attr.rowspan]="item.diagnosisIndustrialParts.length || 1"
      >
        {{ formatNames(item.injurySides) }}
      </td>

      <td
        class="body-md"
        [attr.rowspan]="item.diagnosisIndustrialParts.length || 1"
      >
        {{ formatNames(item.injuryTypes) }}
      </td>
      }

      <!-- اسم القطعة -->
      <td class="body-md">
        {{ part.partName || "—" }}
      </td>

      <!-- الكمية -->
      <td class="body-md">
        {{ part.quantity || "—" }}
      </td>

      <!-- الوحدة -->
      <td class="body-md">
        {{ part.unitName || "—" }}
      </td>

      @if (i === 0) {
      <td [attr.rowspan]="item.diagnosisIndustrialParts.length || 1">
        <button class="btn primary icon" type="button" (click)="onView(item)">
          <img src="assets/icons/eye-icon.svg" alt="عرض التفاصيل" />
        </button>
      </td>
      }
    </tr>
    } } }
  </tbody>
</table>

}
