<!-- 
<div class="width-100">
  <p class="title-md">التشخيصات السابقة</p>
  <span class="home-line"></span>
</div>

@if (items.length === 0) {
  <p class="body-md padding-16">لا توجد تشخيصات سابقة لهذا المريض.</p>
} @else {

<table>
  <thead>
    <tr>
      <th class="title-sm">رقم الكرت</th>
      <th class="title-sm">التاريخ</th>
      <th class="title-sm">البرامح العلاجية</th>
      <th class="buttons"></th>
    </tr>
  </thead>

  <tbody>
    @for (card of items; track card.therapyCardId) {

      @for (program of card.programs; track program.programName; let i = $index) {
        <tr>
          @if (i === 0) {
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.cardNumber }}
            </td>

            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.cardDate | date: 'dd-MM-YYYY' }}
            </td>
          }

          <td class="body-md">
            {{ program.programName }}
            @if (program.totalSessions != null) {
              ({{ program.totalSessions }})
            }
          </td>

          @if (i === 0) {
            <td
              [attr.rowspan]="card.programs.length"
            >
              <button
                class="btn primary icon"
                type="button"
                (click)="onView(card)"
              >
                <img
                  src="assets/icons/eye-icon.svg"
                  alt="عرض التفاصيل"
                />
              </button>
            </td>
          }
        </tr>
      }

    }
  </tbody>
</table>

} -->



<!-- src/app/features/Diagnosis/Therapy/Components/therapy-card-history-table/therapy-card-history-table.component.html -->

<div class="width-100">
  <p class="title-md">التشخيصات السابقة</p>
  <span class="home-line"></span>
</div>

@if (items.length === 0) {
  <p class="body-md padding-16">لا توجد تشخيصات سابقة لهذا المريض.</p>
} @else {
<div class="table-wrapper">


<table>
  <thead>
    <tr>
      <th class="title-sm">رقم الكرت</th>
      <th class="title-sm">التاريخ</th>
      <th class="title-sm">القسم</th>
      <th class="title-sm">ملخص التشخيص</th>
      <th class="title-sm">مدة العلاج</th>
      <th class="title-sm">البرامج العلاجية</th>
      <th class="title-sm">الحالة</th>
      <th class="title-sm">الطبيب</th>
      <th class="buttons"></th>
    </tr>
  </thead>

  <tbody>
    @for (card of items; track card.therapyCardId) {

      @for (program of card.programs; track program.programName; let i = $index) {
        <tr>

          @if (i === 0) {
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.cardNumber }}
            </td>

            <!-- تاريخ الكرت -->
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.cardDate | date: 'dd-MM-YYYY' }}
            </td>

            <!-- القسم -->
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.departmentName }}
            </td>

            <!-- ملخص التشخيص -->
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.diagnosisSummary }}
              @if (card.notes) {
                <div class="notes">ملاحظة: {{ card.notes }}</div>
              }
            </td>

            <!-- المدة (من → إلى) -->
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.startDate | date: 'dd-MM-YYYY' }}
              @if (card.endDate) {
                → {{ card.endDate | date: 'dd-MM-YYYY' }}
              }
            </td>
          }

          <!-- البرامج -->
          <td class="body-md">
            {{ program.programName }}
            @if (program.totalSessions != null) {
              ({{ program.totalSessions }})
            }
          </td>

          <!-- الحالة -->
          @if (i === 0) {
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              <span class="status-badge" [class]="card.status">
                {{
                  card.status === 'completed' ? 'مكتمل' :
                  card.status === 'active' ? 'جارٍ' :
                  card.status === 'stopped' ? 'متوقف' :
                  'ملغي'
                }}
              </span>
            </td>

            <!-- الطبيب -->
            <td
              class="body-md"
              [attr.rowspan]="card.programs.length"
            >
              {{ card.createdBy }}
            </td>

            <!-- زر عرض التفاصيل -->
            <td
              [attr.rowspan]="card.programs.length"
            >
              <button
                class="btn primary icon"
                type="button"
                (click)="onView(card)"
              >
                <img
                  src="assets/icons/eye-icon.svg"
                  alt="عرض التفاصيل"
                />
              </button>
            </td>
          }
        </tr>
      }

    }
  </tbody>
</table>
</div>  
}

